# 仕様

## 前提
- 記事や画像はGitHubリポジトリに保存する

## 認証
### ログイン
- GitHubアカウントでログインできること
- ログイン後の認証トークンはCookieで保持する
- 認証トークンが有効期間の場合は自動ログインでトークンを更新すること
- 初回ログインのときにGitHubのアカウント名を著者情報の著者名として自動で登録すること

## 初期設定
### 連携するGitHubリポジトリの登録
- 記事や画像を保存するGitHubリポジトリをリポジトリ名で設定できること
- リポジトリ名が存在しない場合はエラーメッセージを表示すること
- 設定情報はローカルストレージに保存する
    - プライベートなリポジトリ名をローカルストレージに保存するのでセキュリティ的に少し不安

## 記事の管理
### 記事の登録
- 以下の項目を設定できること
    - スラッグ
        - 必須
        - 重複したスラッグは登録できないこと
    - タイトル
        - 必須
        - 文字数は40文字以内であること
    - 著者名
        - 必須
        - 著者情報から自動で著者名を挿入すること
    - タグ
    - 内容
        - 必須
        - マークダウン形式で記述できること
- 記事に埋め込む画像をアップロードできること

### 画像アップロード
- ファイル選択で画像をアップロードできること
    - D&Dはスコープ外とする
- アップロード時に自動で内容にカーソルがフォーカスされている場合は自動でマークダウン形式で挿入されること
- バリデーション
    - XXMB 以上の画像はアップロードできないこと
    - jpeg, webp, gif 以外の形式はアップロードできないこと
        - ブログのルールとして扱う画像を決める
- アップロードした画像を削除できること
    - 記事を保存前の場合はメモリ上から削除する
    - 記事を保存済みの場合はGitHubリポジトリから削除する
- 記事を保存する時にGitHubリポジトリに画像を保存すること

### 記事のタグ付け
- タグは複数設定できること
- テキストベースでタグを記述できること
- 選択候補として登録済みのタグを表示すること
- 記述したタグが未登録の場合は記事を保存したタイミング（下書き保存と公開）で新規のタグとして登録されること

### 記事のプレビュー表示
- プレビューボタンを押したときに別タブで自身のブログデザインで記事のプレビューが表示されること
- MicroCMSとかのプレビュー機能を参考に設計を考える

### 記事の保存
- 下書き保存、公開の操作を記事の保存として扱うこと
    - 各操作ごとのGitHubへの操作は各操作の仕様にて定義    
- 保存前に項目の値をバリデーションすること
    - 記事の項目の値は適切か
    - アップロード画像のファイルサイズや形式は適切か
- 連携先のGitHubリポジトリが存在しない場合はエラーメッセージを表示すること
    - xxx のリポジトリは存在しません。連携するGitHubリポジトリを再設定してください。
- 記事はマークダウンファイルに変換すること
    - ファイル名はindex.mdとすること
    - タイトルなどのメタデータを frontmatter として書き出すこと
- マークダウンファイルとアップロード画像をGitHubリポジトリに保存すること
    - スラッグ名でディレクトリを作成して、その配下にマークダウンファイルとアップロード画像を保存する
    - 削除対応の時にディレクトリを削除するだけで対応ができる

```markdown
// wasm-othello.md
---
title: WebAssemblyでオセロを作った話
date: 2020-12-02
description: WebAssemblyの速度を体感するために、WebAssemblyでオセロのゲームアルゴリズムを実装しました
tags: ['フロントエンド']
---

本文

```

### 記事の下書き保存
- 保存の仕様は「記事の保存」を参照
- スラッグ名で新しくブランチを作成して、そのブランチに対してマークダウンファイルとアップロード画像をプッシュすること
- マークダウンファイルの frontmatter に以下のメタデータを追加すること
    - published: false

### 記事の公開
- 保存の仕様は「記事の保存」を参照
- mainブランチに対してマークダウンファイルとアップロード画像をプッシュすること
- マークダウンファイルの frontmatter に以下のメタデータを追加すること
    - published: true
    - published_at: 2021-02-23T21:31:47+09:00 (ISO8601形式の現在時刻)
    - updated_at: 2021-02-23T21:31:47+09:00 (ISO8601形式の現在時刻)

### 記事を非公開に更新する
- マークダウンファイルの frontmatter で以下のメタデータを更新すること
    - published: false
- mainブランチに対してマークダウンファイルをプッシュすること

### 記事の更新する
- マークダウンファイルの frontmatter で以下のメタデータを更新すること
    - updated_at: 2021-02-24T19:12:38+09:00 (ISO8601形式の現在時刻)
- mainブランチに対してマークダウンファイルとアップロード画像をプッシュすること

### 記事の削除
- mainブランチに対して、対応するスラッグ名のディレクトリの削除をプッシュすること

## タグ管理
### タグのCRUD
- 登録済みのタグ一覧が確認できること
- タグを登録できること
- 登録済みのタグを更新できること
- 登録済みのタグを削除できること

## 設定
### 著者情報の管理
- 以下の項目を設定できること
    - 著者名

### 連携するGitHubリポジトリの管理
- リポジトリ名で連携するGitHubリポジトリを設定できること    
    - 存在しないリポジトリ名は指定できないこと
    - 空文字には設定できないこと（設定は必須）
